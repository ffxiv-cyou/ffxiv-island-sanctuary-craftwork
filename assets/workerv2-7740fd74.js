(function(){"use strict";let r;const z=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&z.decode();let x=null;function A(){return(x===null||x.byteLength===0)&&(x=new Uint8Array(r.memory.buffer)),x}function U(t,n){return t=t>>>0,z.decode(A().subarray(t,t+n))}let o=0;const R=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},C=typeof R.encodeInto=="function"?function(t,n){return R.encodeInto(t,n)}:function(t,n){const e=R.encode(t);return n.set(e),{read:t.length,written:e.length}};function V(t,n,e){if(e===void 0){const c=R.encode(t),f=n(c.length,1)>>>0;return A().subarray(f,f+c.length).set(c),o=c.length,f}let _=t.length,s=n(_,1)>>>0;const a=A();let i=0;for(;i<_;i++){const c=t.charCodeAt(i);if(c>127)break;a[s+i]=c}if(i!==_){i!==0&&(t=t.slice(i)),s=e(s,_,_=i+t.length*3,1)>>>0;const c=A().subarray(s+i,s+_),f=C(t,c);i+=f.written,s=e(s,_,i,1)>>>0}return o=i,s}let h=null;function D(){return(h===null||h.buffer.detached===!0||h.buffer.detached===void 0&&h.buffer!==r.memory.buffer)&&(h=new DataView(r.memory.buffer)),h}let E=null;function L(){return(E===null||E.byteLength===0)&&(E=new Uint16Array(r.memory.buffer)),E}function q(t,n){const e=n(t.length*2,2)>>>0;return L().set(t,e/2),o=t.length,e}function l(t,n){const e=n(t.length*1,1)>>>0;return A().set(t,e/1),o=t.length,e}function k(t,n){if(!(t instanceof n))throw new Error(`expected instance of ${n.name}`)}function p(t,n){return t=t>>>0,L().subarray(t/2,t/2+n)}function B(t,n){return t=t>>>0,A().subarray(t/1,t/1+n)}function P(t,n){const e=l(t,r.__wbindgen_malloc),_=o,s=r.pattern_predict(e,_,n);var a=B(s[0],s[1]).slice();return r.__wbindgen_free(s[0],s[1]*1,1),a}function N(t,n){const e=l(t,r.__wbindgen_malloc),_=o,s=r.pattern_predict_adv(e,_,n);var a=p(s[0],s[1]).slice();return r.__wbindgen_free(s[0],s[1]*2,2),a}let F=null;function $(){return(F===null||F.byteLength===0)&&(F=new Int8Array(r.memory.buffer)),F}function G(t,n){return t=t>>>0,$().subarray(t/1,t/1+n)}function H(t,n){const e=l(t,r.__wbindgen_malloc),_=o,s=r.pattern_demand(e,_,n);var a=G(s[0],s[1]).slice();return r.__wbindgen_free(s[0],s[1]*1,1),a}function J(t,n,e){const _=q(t,r.__wbindgen_malloc),s=o,a=l(n,r.__wbindgen_malloc),i=o,c=r.init_api_v2(_,s,a,i,e);return T.__wrap(c)}const O=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>r.__wbg_apiv2_free(t>>>0,1));class T{static __wrap(n){n=n>>>0;const e=Object.create(T.prototype);return e.__wbg_ptr=n,O.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const n=this.__wbg_ptr;return this.__wbg_ptr=0,O.unregister(this),n}free(){const n=this.__destroy_into_raw();r.__wbg_apiv2_free(n,0)}set_pattern(n){r.apiv2_set_pattern(this.__wbg_ptr,n)}simulate(n,e,_){k(n,y);const s=l(e,r.__wbindgen_malloc),a=o,i=l(_,r.__wbindgen_malloc),c=o,f=r.apiv2_simulate(this.__wbg_ptr,n.__wbg_ptr,s,a,i,c);var u=p(f[0],f[1]).slice();return r.__wbindgen_free(f[0],f[1]*2,2),u}solve_day_with_batch(n,e,_,s,a,i,c,f){k(n,y);const u=l(_,r.__wbindgen_malloc),g=o,b=l(s,r.__wbindgen_malloc),w=o,d=l(a,r.__wbindgen_malloc),v=o,m=r.apiv2_solve_day_with_batch(this.__wbg_ptr,n.__wbg_ptr,e,u,g,b,w,d,v,i,c,f);var I=p(m[0],m[1]).slice();return r.__wbindgen_free(m[0],m[1]*2,2),I}solve_day_dual(n,e,_,s,a,i,c){k(n,y);const f=l(_,r.__wbindgen_malloc),u=o,g=l(s,r.__wbindgen_malloc),b=o,w=r.apiv2_solve_day_dual(this.__wbg_ptr,n.__wbg_ptr,e,f,u,g,b,a,i,c);var d=p(w[0],w[1]).slice();return r.__wbindgen_free(w[0],w[1]*2,2),d}solve_day_with_favor(n,e,_,s,a,i,c,f,u){k(n,y);const g=l(_,r.__wbindgen_malloc),b=o,w=l(s,r.__wbindgen_malloc),d=o,v=l(a,r.__wbindgen_malloc),m=o,I=l(i,r.__wbindgen_malloc),Z=o,W=r.apiv2_solve_day_with_favor(this.__wbg_ptr,n.__wbg_ptr,e,g,b,w,d,v,m,I,Z,c,f,u);var ee=p(W[0],W[1]).slice();return r.__wbindgen_free(W[0],W[1]*2,2),ee}solve_week_single(n,e,_,s,a,i){k(n,y);const c=l(_,r.__wbindgen_malloc),f=o,u=l(i,r.__wbindgen_malloc),g=o,b=r.apiv2_solve_week_single(this.__wbg_ptr,n.__wbg_ptr,e,c,f,s,a,u,g);var w=p(b[0],b[1]).slice();return r.__wbindgen_free(b[0],b[1]*2,2),w}solver_clear_cache(){r.apiv2_solver_clear_cache(this.__wbg_ptr)}solve_week_part(n,e,_,s,a,i,c){k(n,y);const f=l(_,r.__wbindgen_malloc),u=o,g=l(i,r.__wbindgen_malloc),b=o,w=r.apiv2_solve_week_part(this.__wbg_ptr,n.__wbg_ptr,e,f,u,s,a,g,b,c);var d=p(w[0],w[1]).slice();return r.__wbindgen_free(w[0],w[1]*2,2),d}solve_week_favor(n,e,_,s,a,i,c){k(n,y);const f=l(_,r.__wbindgen_malloc),u=o,g=l(i,r.__wbindgen_malloc),b=o,w=l(c,r.__wbindgen_malloc),d=o,v=r.apiv2_solve_week_favor(this.__wbg_ptr,n.__wbg_ptr,e,f,u,s,a,g,b,w,d);var m=p(v[0],v[1]).slice();return r.__wbindgen_free(v[0],v[1]*2,2),m}}const S=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>r.__wbg_craftworkinfo_free(t>>>0,1));class y{__destroy_into_raw(){const n=this.__wbg_ptr;return this.__wbg_ptr=0,S.unregister(this),n}free(){const n=this.__destroy_into_raw();r.__wbg_craftworkinfo_free(n,0)}get tension(){return r.__wbg_get_craftworkinfo_tension(this.__wbg_ptr)}set tension(n){r.__wbg_set_craftworkinfo_tension(this.__wbg_ptr,n)}get max_tension(){return r.__wbg_get_craftworkinfo_max_tension(this.__wbg_ptr)}set max_tension(n){r.__wbg_set_craftworkinfo_max_tension(this.__wbg_ptr,n)}get level(){return r.__wbg_get_craftworkinfo_level(this.__wbg_ptr)}set level(n){r.__wbg_set_craftworkinfo_level(this.__wbg_ptr,n)}get workers(){return r.__wbg_get_craftworkinfo_workers(this.__wbg_ptr)}set workers(n){r.__wbg_set_craftworkinfo_workers(this.__wbg_ptr,n)}constructor(n,e,_,s){const a=r.craftworkinfo_new(n,e,_,s);return this.__wbg_ptr=a>>>0,S.register(this,this.__wbg_ptr,this),this}}typeof FinalizationRegistry>"u"||new FinalizationRegistry(t=>r.__wbg_favor_free(t>>>0,1)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(t=>r.__wbg_gamedatarepo_free(t>>>0,1));async function K(t,n){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,n)}catch(_){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",_);else throw _}const e=await t.arrayBuffer();return await WebAssembly.instantiate(e,n)}else{const e=await WebAssembly.instantiate(t,n);return e instanceof WebAssembly.Instance?{instance:e,module:t}:e}}function Q(){const t={};return t.wbg={},t.wbg.__wbg_error_7534b8e9a36f1ab4=function(n,e){let _,s;try{_=n,s=e,console.error(U(n,e))}finally{r.__wbindgen_free(_,s,1)}},t.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},t.wbg.__wbg_stack_0ed75d68575b0f3c=function(n,e){const _=e.stack,s=V(_,r.__wbindgen_malloc,r.__wbindgen_realloc),a=o;D().setInt32(n+4*1,a,!0),D().setInt32(n+4*0,s,!0)},t.wbg.__wbindgen_init_externref_table=function(){const n=r.__wbindgen_export_3,e=n.grow(4);n.set(0,void 0),n.set(e+0,void 0),n.set(e+1,null),n.set(e+2,!0),n.set(e+3,!1)},t.wbg.__wbindgen_throw=function(n,e){throw new Error(U(n,e))},t}function X(t,n){return r=t.exports,j.__wbindgen_wasm_module=n,h=null,F=null,E=null,x=null,r.__wbindgen_start(),r}async function j(t){if(r!==void 0)return r;typeof t<"u"&&(Object.getPrototypeOf(t)===Object.prototype?{module_or_path:t}=t:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof t>"u"&&(t=new URL("/assets/mji_craftwork_bg-468c1040.wasm",self.location));const n=Q();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:e,module:_}=await K(await t,n);return X(e,_)}function M(t){return new y(t.tension,t.max_tension,t.level,t.workers)}async function Y(){await j(),self.postMessage({type:"inited"});let t;self.onmessage=async n=>{const e=n.data;switch(e.type){case"init_repo":t=J(e.recipe,e.pops,e.pop_row),self.postMessage({type:"init_repo"});return;case"pattern_predict":{const _=P(e.array,e.demands);self.postMessage(_,[_.buffer]);return}case"pattern_predict_adv":{const _=N(e.array,e.demands);self.postMessage(_,[_.buffer]);return}case"pattern_demand":{const _=H(e.array,e.day);self.postMessage(_,[_.buffer]);return}default:if(!t)return self.reportError("repo is not inited. "+e.type);break}switch(e.type){case"set_pattern":t.set_pattern(e.pattern),self.postMessage({type:"set_pattern"});break;case"solve_week":{const _=M(e.state),s=t.solve_week_single(_,e.level,e.ban_list,e.time,e.with_cost,e.pattern);self.postMessage(s,[s.buffer]);break}case"solve_multi_day":{const _=M(e.state),s=t.solve_day_with_batch(_,e.level,e.ban_list,e.set,e.demands,e.worker,e.time,e.with_cost);self.postMessage(s,[s.buffer]);break}case"solve_day_dual":{const _=M(e.state),s=t.solve_day_dual(_,e.level,e.ban_list,e.demands,e.worker,e.time,e.with_cost);self.postMessage(s,[s.buffer]);break}case"solve_day_favor":{const _=M(e.state),s=t.solve_day_with_favor(_,e.level,e.ban_list,e.set,e.demands,e.favors,e.worker,e.time,e.with_cost);self.postMessage(s,[s.buffer]);break}case"solve_week_part":{const _=M(e.state),s=t.solve_week_part(_,e.level,e.ban_list,e.time,e.with_cost,e.pattern,e.part_id);self.postMessage(s,[s.buffer]);break}case"solve_week_favor":{const _=M(e.state),s=t.solve_week_favor(_,e.level,e.ban_list,e.time,e.with_cost,e.pattern,e.favors);self.postMessage(s,[s.buffer]);break}case"solve_cache_clear":{t.solver_clear_cache(),self.postMessage({type:"solve_cache_clear"});break}case"simulate_multi":{const _=M(e.state),s=t.simulate(_,e.seq,e.demands);self.postMessage(s,[s.buffer]);break}case"simulate":return self.reportError("simulate is deprecated. use simulate_multi instead");case"solve_day":return self.reportError("solve_day is deprecated. use solve_multi_day instead");default:console.log("unexpected type",e.type),self.reportError("unexpected type "+e.type);break}}}Y()})();
