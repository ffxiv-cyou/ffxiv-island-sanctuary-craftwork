(function(){"use strict";class F{static __wrap(t){t=t>>>0;const e=Object.create(F.prototype);return e.__wbg_ptr=t,D.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,D.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_apiv2_free(t,0)}set_pattern(t){r.apiv2_set_pattern(this.__wbg_ptr,t)}simulate(t,e,_){h(t,g);const s=l(e,r.__wbindgen_malloc),i=o,a=l(_,r.__wbindgen_malloc),c=o,f=r.apiv2_simulate(this.__wbg_ptr,t.__wbg_ptr,s,i,a,c);var p=y(f[0],f[1]).slice();return r.__wbindgen_free(f[0],f[1]*2,2),p}solve_day_dual(t,e,_,s,i,a,c){h(t,g);const f=l(_,r.__wbindgen_malloc),p=o,u=l(s,r.__wbindgen_malloc),b=o,w=r.apiv2_solve_day_dual(this.__wbg_ptr,t.__wbg_ptr,e,f,p,u,b,i,a,c);var d=y(w[0],w[1]).slice();return r.__wbindgen_free(w[0],w[1]*2,2),d}solve_day_with_batch(t,e,_,s,i,a,c,f){h(t,g);const p=l(_,r.__wbindgen_malloc),u=o,b=l(s,r.__wbindgen_malloc),w=o,d=l(i,r.__wbindgen_malloc),m=o,v=r.apiv2_solve_day_with_batch(this.__wbg_ptr,t.__wbg_ptr,e,p,u,b,w,d,m,a,c,f);var T=y(v[0],v[1]).slice();return r.__wbindgen_free(v[0],v[1]*2,2),T}solve_day_with_favor(t,e,_,s,i,a,c,f,p){h(t,g);const u=l(_,r.__wbindgen_malloc),b=o,w=l(s,r.__wbindgen_malloc),d=o,m=l(i,r.__wbindgen_malloc),v=o,T=l(a,r.__wbindgen_malloc),re=o,S=r.apiv2_solve_day_with_favor(this.__wbg_ptr,t.__wbg_ptr,e,u,b,w,d,m,v,T,re,c,f,p);var se=y(S[0],S[1]).slice();return r.__wbindgen_free(S[0],S[1]*2,2),se}solve_week_favor(t,e,_,s,i,a,c){h(t,g);const f=l(_,r.__wbindgen_malloc),p=o,u=l(a,r.__wbindgen_malloc),b=o,w=l(c,r.__wbindgen_malloc),d=o,m=r.apiv2_solve_week_favor(this.__wbg_ptr,t.__wbg_ptr,e,f,p,s,i,u,b,w,d);var v=y(m[0],m[1]).slice();return r.__wbindgen_free(m[0],m[1]*2,2),v}solve_week_part(t,e,_,s,i,a,c){h(t,g);const f=l(_,r.__wbindgen_malloc),p=o,u=l(a,r.__wbindgen_malloc),b=o,w=r.apiv2_solve_week_part(this.__wbg_ptr,t.__wbg_ptr,e,f,p,s,i,u,b,c);var d=y(w[0],w[1]).slice();return r.__wbindgen_free(w[0],w[1]*2,2),d}solve_week_single(t,e,_,s,i,a){h(t,g);const c=l(_,r.__wbindgen_malloc),f=o,p=l(a,r.__wbindgen_malloc),u=o,b=r.apiv2_solve_week_single(this.__wbg_ptr,t.__wbg_ptr,e,c,f,s,i,p,u);var w=y(b[0],b[1]).slice();return r.__wbindgen_free(b[0],b[1]*2,2),w}solver_clear_cache(){r.apiv2_solver_clear_cache(this.__wbg_ptr)}}Symbol.dispose&&(F.prototype[Symbol.dispose]=F.prototype.free);class g{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,O.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_craftworkinfo_free(t,0)}constructor(t,e,_,s){const i=r.craftworkinfo_new(t,e,_,s);return this.__wbg_ptr=i>>>0,O.register(this,this.__wbg_ptr,this),this}get level(){return r.__wbg_get_craftworkinfo_level(this.__wbg_ptr)}get max_tension(){return r.__wbg_get_craftworkinfo_max_tension(this.__wbg_ptr)}get tension(){return r.__wbg_get_craftworkinfo_tension(this.__wbg_ptr)}get workers(){return r.__wbg_get_craftworkinfo_workers(this.__wbg_ptr)}set level(t){r.__wbg_set_craftworkinfo_level(this.__wbg_ptr,t)}set max_tension(t){r.__wbg_set_craftworkinfo_max_tension(this.__wbg_ptr,t)}set tension(t){r.__wbg_set_craftworkinfo_tension(this.__wbg_ptr,t)}set workers(t){r.__wbg_set_craftworkinfo_workers(this.__wbg_ptr,t)}}Symbol.dispose&&(g.prototype[Symbol.dispose]=g.prototype.free);class U{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,X.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_favor_free(t,0)}get id(){return r.__wbg_get_favor_id(this.__wbg_ptr)}get num(){return r.__wbg_get_favor_num(this.__wbg_ptr)}set id(t){r.__wbg_set_favor_id(this.__wbg_ptr,t)}set num(t){r.__wbg_set_favor_num(this.__wbg_ptr,t)}}Symbol.dispose&&(U.prototype[Symbol.dispose]=U.prototype.free);function B(n,t,e){const _=H(n,r.__wbindgen_malloc),s=o,i=l(t,r.__wbindgen_malloc),a=o,c=r.init_api_v2(_,s,i,a,e);return F.__wrap(c)}function V(n,t){const e=l(n,r.__wbindgen_malloc),_=o,s=r.pattern_demand(e,_,t);var i=Y(s[0],s[1]).slice();return r.__wbindgen_free(s[0],s[1]*1,1),i}function q(n,t){const e=l(n,r.__wbindgen_malloc),_=o,s=r.pattern_predict(e,_,t);var i=$(s[0],s[1]).slice();return r.__wbindgen_free(s[0],s[1]*1,1),i}function P(n,t){const e=l(n,r.__wbindgen_malloc),_=o,s=r.pattern_predict_adv(e,_,t);var i=y(s[0],s[1]).slice();return r.__wbindgen_free(s[0],s[1]*2,2),i}function N(){return{__proto__:null,"./mji_craftwork_bg.js":{__proto__:null,__wbg___wbindgen_throw_be289d5034ed271b:function(t,e){throw new Error(C(t,e))},__wbg_error_7534b8e9a36f1ab4:function(t,e){let _,s;try{_=t,s=e,console.error(C(t,e))}finally{r.__wbindgen_free(_,s,1)}},__wbg_new_8a6f238a6ece86ea:function(){return new Error},__wbg_stack_0ed75d68575b0f3c:function(t,e){const _=e.stack,s=J(_,r.__wbindgen_malloc,r.__wbindgen_realloc),i=o;j().setInt32(t+4,i,!0),j().setInt32(t+0,s,!0)},__wbindgen_init_externref_table:function(){const t=r.__wbindgen_externrefs,e=t.grow(4);t.set(0,void 0),t.set(e+0,void 0),t.set(e+1,null),t.set(e+2,!0),t.set(e+3,!1)}}}}const D=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>r.__wbg_apiv2_free(n>>>0,1)),O=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>r.__wbg_craftworkinfo_free(n>>>0,1)),X=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>r.__wbg_favor_free(n>>>0,1));typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>r.__wbg_gamedatarepo_free(n>>>0,1));function h(n,t){if(!(n instanceof t))throw new Error(`expected instance of ${t.name}`)}function Y(n,t){return n=n>>>0,G().subarray(n/1,n/1+t)}function y(n,t){return n=n>>>0,L().subarray(n/2,n/2+t)}function $(n,t){return n=n>>>0,A().subarray(n/1,n/1+t)}let k=null;function j(){return(k===null||k.buffer.detached===!0||k.buffer.detached===void 0&&k.buffer!==r.memory.buffer)&&(k=new DataView(r.memory.buffer)),k}let R=null;function G(){return(R===null||R.byteLength===0)&&(R=new Int8Array(r.memory.buffer)),R}function C(n,t){return n=n>>>0,Q(n,t)}let x=null;function L(){return(x===null||x.byteLength===0)&&(x=new Uint16Array(r.memory.buffer)),x}let W=null;function A(){return(W===null||W.byteLength===0)&&(W=new Uint8Array(r.memory.buffer)),W}function H(n,t){const e=t(n.length*2,2)>>>0;return L().set(n,e/2),o=n.length,e}function l(n,t){const e=t(n.length*1,1)>>>0;return A().set(n,e/1),o=n.length,e}function J(n,t,e){if(e===void 0){const c=E.encode(n),f=t(c.length,1)>>>0;return A().subarray(f,f+c.length).set(c),o=c.length,f}let _=n.length,s=t(_,1)>>>0;const i=A();let a=0;for(;a<_;a++){const c=n.charCodeAt(a);if(c>127)break;i[s+a]=c}if(a!==_){a!==0&&(n=n.slice(a)),s=e(s,_,_=a+n.length*3,1)>>>0;const c=A().subarray(s+a,s+_),f=E.encodeInto(n,c);a+=f.written,s=e(s,_,a,1)>>>0}return o=a,s}let I=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});I.decode();const K=2146435072;let z=0;function Q(n,t){return z+=t,z>=K&&(I=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),I.decode(),z=t),I.decode(A().subarray(n,n+t))}const E=new TextEncoder;"encodeInto"in E||(E.encodeInto=function(n,t){const e=E.encode(n);return t.set(e),{read:n.length,written:e.length}});let o=0,r;function Z(n,t){return r=n.exports,k=null,R=null,x=null,W=null,r.__wbindgen_start(),r}async function ee(n,t){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,t)}catch(s){if(n.ok&&e(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const _=await n.arrayBuffer();return await WebAssembly.instantiate(_,t)}else{const _=await WebAssembly.instantiate(n,t);return _ instanceof WebAssembly.Instance?{instance:_,module:n}:_}function e(_){switch(_){case"basic":case"cors":case"default":return!0}return!1}}async function te(n){if(r!==void 0)return r;n!==void 0&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),n===void 0&&(n=new URL("/assets/mji_craftwork_bg-d676feb7.wasm",self.location));const t=N();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:e,module:_}=await ee(await n,t);return Z(e)}function M(n){return new g(n.tension,n.max_tension,n.level,n.workers)}async function ne(){await te(),self.postMessage({type:"inited"});let n;self.onmessage=async t=>{const e=t.data;switch(e.type){case"init_repo":n=B(e.recipe,e.pops,e.pop_row),self.postMessage({type:"init_repo"});return;case"pattern_predict":{const _=q(e.array,e.demands);self.postMessage(_,[_.buffer]);return}case"pattern_predict_adv":{const _=P(e.array,e.demands);self.postMessage(_,[_.buffer]);return}case"pattern_demand":{const _=V(e.array,e.day);self.postMessage(_,[_.buffer]);return}default:if(!n)return self.reportError("repo is not inited. "+e.type);break}switch(e.type){case"set_pattern":n.set_pattern(e.pattern),self.postMessage({type:"set_pattern"});break;case"solve_week":{const _=M(e.state),s=n.solve_week_single(_,e.level,e.ban_list,e.time,e.with_cost,e.pattern);self.postMessage(s,[s.buffer]);break}case"solve_multi_day":{const _=M(e.state),s=n.solve_day_with_batch(_,e.level,e.ban_list,e.set,e.demands,e.worker,e.time,e.with_cost);self.postMessage(s,[s.buffer]);break}case"solve_day_dual":{const _=M(e.state),s=n.solve_day_dual(_,e.level,e.ban_list,e.demands,e.worker,e.time,e.with_cost);self.postMessage(s,[s.buffer]);break}case"solve_day_favor":{const _=M(e.state),s=n.solve_day_with_favor(_,e.level,e.ban_list,e.set,e.demands,e.favors,e.worker,e.time,e.with_cost);self.postMessage(s,[s.buffer]);break}case"solve_week_part":{const _=M(e.state),s=n.solve_week_part(_,e.level,e.ban_list,e.time,e.with_cost,e.pattern,e.part_id);self.postMessage(s,[s.buffer]);break}case"solve_week_favor":{const _=M(e.state),s=n.solve_week_favor(_,e.level,e.ban_list,e.time,e.with_cost,e.pattern,e.favors);self.postMessage(s,[s.buffer]);break}case"solve_cache_clear":{n.solver_clear_cache(),self.postMessage({type:"solve_cache_clear"});break}case"simulate_multi":{const _=M(e.state),s=n.simulate(_,e.seq,e.demands);self.postMessage(s,[s.buffer]);break}case"simulate":return self.reportError("simulate is deprecated. use simulate_multi instead");case"solve_day":return self.reportError("solve_day is deprecated. use solve_multi_day instead");default:console.log("unexpected type",e.type),self.reportError("unexpected type "+e.type);break}}}ne()})();
