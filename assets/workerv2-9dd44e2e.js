(function(){"use strict";let r;const u=new Array(128).fill(void 0);u.push(void 0,null,!0,!1);function L(t){return u[t]}let M=u.length;function q(t){t<132||(u[t]=M,M=t)}function C(t){const e=L(t);return q(t),e}const R=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&R.decode();let A=null;function v(){return(A===null||A.byteLength===0)&&(A=new Uint8Array(r.memory.buffer)),A}function S(t,e){return t=t>>>0,R.decode(v().subarray(t,t+e))}let x=null;function F(){return(x===null||x.byteLength===0)&&(x=new Uint16Array(r.memory.buffer)),x}let c=0;function B(t,e){const n=e(t.length*2,2)>>>0;return F().set(t,n/2),c=t.length,n}function f(t,e){const n=e(t.length*1,1)>>>0;return v().set(t,n/1),c=t.length,n}function E(t,e){if(!(t instanceof e))throw new Error(`expected instance of ${e.name}`);return t.ptr}let W=null;function l(){return(W===null||W.byteLength===0)&&(W=new Int32Array(r.memory.buffer)),W}function k(t,e){return t=t>>>0,F().subarray(t/2,t/2+e)}function z(t,e){return t=t>>>0,v().subarray(t/1,t/1+e)}function H(t,e){try{const o=r.__wbindgen_add_to_stack_pointer(-16),i=f(t,r.__wbindgen_malloc),a=c;r.pattern_predict(o,i,a,e);var n=l()[o/4+0],_=l()[o/4+1],s=z(n,_).slice();return r.__wbindgen_free(n,_*1),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}function N(t,e){try{const o=r.__wbindgen_add_to_stack_pointer(-16),i=f(t,r.__wbindgen_malloc),a=c;r.pattern_predict_adv(o,i,a,e);var n=l()[o/4+0],_=l()[o/4+1],s=k(n,_).slice();return r.__wbindgen_free(n,_*2),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}let T=null;function V(){return(T===null||T.byteLength===0)&&(T=new Int8Array(r.memory.buffer)),T}function $(t,e){return t=t>>>0,V().subarray(t/1,t/1+e)}function G(t,e){try{const o=r.__wbindgen_add_to_stack_pointer(-16),i=f(t,r.__wbindgen_malloc),a=c;r.pattern_demand(o,i,a,e);var n=l()[o/4+0],_=l()[o/4+1],s=$(n,_).slice();return r.__wbindgen_free(n,_*1),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}function J(t,e,n){const _=B(t,r.__wbindgen_malloc),s=c,o=f(e,r.__wbindgen_malloc),i=c,a=r.init_api_v2(_,s,o,i,n);return O.__wrap(a)}function K(t){M===u.length&&u.push(u.length+1);const e=M;return M=u[e],u[e]=t,e}const U=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},P=typeof U.encodeInto=="function"?function(t,e){return U.encodeInto(t,e)}:function(t,e){const n=U.encode(t);return e.set(n),{read:t.length,written:n.length}};function Q(t,e,n){if(n===void 0){const a=U.encode(t),d=e(a.length,1)>>>0;return v().subarray(d,d+a.length).set(a),c=a.length,d}let _=t.length,s=e(_,1)>>>0;const o=v();let i=0;for(;i<_;i++){const a=t.charCodeAt(i);if(a>127)break;o[s+i]=a}if(i!==_){i!==0&&(t=t.slice(i)),s=n(s,_,_=i+t.length*3,1)>>>0;const a=v().subarray(s+i,s+_),d=P(t,a);i+=d.written}return c=i,s}class O{static __wrap(e){e=e>>>0;const n=Object.create(O.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_apiv2_free(e)}set_pattern(e){r.apiv2_set_pattern(this.__wbg_ptr,e)}simulate(e,n,_){try{const a=r.__wbindgen_add_to_stack_pointer(-16);E(e,g);const d=f(n,r.__wbindgen_malloc),p=c,b=f(_,r.__wbindgen_malloc),w=c;r.apiv2_simulate(a,this.__wbg_ptr,e.__wbg_ptr,d,p,b,w);var s=l()[a/4+0],o=l()[a/4+1],i=k(s,o).slice();return r.__wbindgen_free(s,o*2),i}finally{r.__wbindgen_add_to_stack_pointer(16)}}solve_day_with_batch(e,n,_,s,o,i,a,d){try{const y=r.__wbindgen_add_to_stack_pointer(-16);E(e,g);const m=f(_,r.__wbindgen_malloc),h=c,I=f(s,r.__wbindgen_malloc),te=c,ne=f(o,r.__wbindgen_malloc),re=c;r.apiv2_solve_day_with_batch(y,this.__wbg_ptr,e.__wbg_ptr,n,m,h,I,te,ne,re,i,a,d);var p=l()[y/4+0],b=l()[y/4+1],w=k(p,b).slice();return r.__wbindgen_free(p,b*2),w}finally{r.__wbindgen_add_to_stack_pointer(16)}}solve_day_dual(e,n,_,s,o,i,a){try{const w=r.__wbindgen_add_to_stack_pointer(-16);E(e,g);const y=f(_,r.__wbindgen_malloc),m=c,h=f(s,r.__wbindgen_malloc),I=c;r.apiv2_solve_day_dual(w,this.__wbg_ptr,e.__wbg_ptr,n,y,m,h,I,o,i,a);var d=l()[w/4+0],p=l()[w/4+1],b=k(d,p).slice();return r.__wbindgen_free(d,p*2),b}finally{r.__wbindgen_add_to_stack_pointer(16)}}solve_week_single(e,n,_,s,o,i){try{const b=r.__wbindgen_add_to_stack_pointer(-16);E(e,g);const w=f(_,r.__wbindgen_malloc),y=c,m=f(i,r.__wbindgen_malloc),h=c;r.apiv2_solve_week_single(b,this.__wbg_ptr,e.__wbg_ptr,n,w,y,s,o,m,h);var a=l()[b/4+0],d=l()[b/4+1],p=k(a,d).slice();return r.__wbindgen_free(a,d*2),p}finally{r.__wbindgen_add_to_stack_pointer(16)}}solver_clear_cache(){r.apiv2_solver_clear_cache(this.__wbg_ptr)}solve_week_part(e,n,_,s,o,i,a){try{const w=r.__wbindgen_add_to_stack_pointer(-16);E(e,g);const y=f(_,r.__wbindgen_malloc),m=c,h=f(i,r.__wbindgen_malloc),I=c;r.apiv2_solve_week_part(w,this.__wbg_ptr,e.__wbg_ptr,n,y,m,s,o,h,I,a);var d=l()[w/4+0],p=l()[w/4+1],b=k(d,p).slice();return r.__wbindgen_free(d,p*2),b}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class g{static __wrap(e){e=e>>>0;const n=Object.create(g.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_craftworkinfo_free(e)}get tension(){return r.__wbg_get_craftworkinfo_tension(this.__wbg_ptr)}set tension(e){r.__wbg_set_craftworkinfo_tension(this.__wbg_ptr,e)}get max_tension(){return r.__wbg_get_craftworkinfo_max_tension(this.__wbg_ptr)}set max_tension(e){r.__wbg_set_craftworkinfo_max_tension(this.__wbg_ptr,e)}get level(){return r.__wbg_get_craftworkinfo_level(this.__wbg_ptr)}set level(e){r.__wbg_set_craftworkinfo_level(this.__wbg_ptr,e)}get workers(){return r.__wbg_get_craftworkinfo_workers(this.__wbg_ptr)}set workers(e){r.__wbg_set_craftworkinfo_workers(this.__wbg_ptr,e)}constructor(e,n,_,s){const o=r.craftworkinfo_new(e,n,_,s);return g.__wrap(o)}}async function X(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(_){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",_);else throw _}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function Y(){const t={};return t.wbg={},t.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return K(e)},t.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const _=L(n).stack,s=Q(_,r.__wbindgen_malloc,r.__wbindgen_realloc),o=c;l()[e/4+1]=o,l()[e/4+0]=s},t.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let _,s;try{_=e,s=n,console.error(S(e,n))}finally{r.__wbindgen_free(_,s,1)}},t.wbg.__wbindgen_object_drop_ref=function(e){C(e)},t.wbg.__wbindgen_throw=function(e,n){throw new Error(S(e,n))},t}function Z(t,e){return r=t.exports,D.__wbindgen_wasm_module=e,W=null,T=null,x=null,A=null,r}async function D(t){if(r!==void 0)return r;typeof t>"u"&&(t="/assets/mji_craftwork_bg.wasm");const e=Y();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:n,module:_}=await X(await t,e);return Z(n,_)}function j(t){return new g(t.tension,t.max_tension,t.level,t.workers)}async function ee(){await D(),self.postMessage({type:"inited"});let t;self.onmessage=async e=>{const n=e.data;switch(n.type){case"init_repo":t=J(n.recipe,n.pops,n.pop_row),self.postMessage({type:"init_repo"});return;case"pattern_predict":{const _=H(n.array,n.demands);self.postMessage(_,[_.buffer]);return}case"pattern_predict_adv":{const _=N(n.array,n.demands);self.postMessage(_,[_.buffer]);return}case"pattern_demand":{const _=G(n.array,n.day);self.postMessage(_,[_.buffer]);return}default:if(!t)return self.reportError("repo is not inited. "+n.type);break}switch(n.type){case"set_pattern":t.set_pattern(n.pattern),self.postMessage({type:"set_pattern"});break;case"solve_week":{const _=j(n.state),s=t.solve_week_single(_,n.level,n.ban_list,n.time,n.with_cost,n.pattern);self.postMessage(s,[s.buffer]);break}case"solve_multi_day":{const _=j(n.state),s=t.solve_day_with_batch(_,n.level,n.ban_list,n.set,n.demands,n.worker,n.time,n.with_cost);self.postMessage(s,[s.buffer]);break}case"solve_day_dual":{const _=j(n.state),s=t.solve_day_dual(_,n.level,n.ban_list,n.demands,n.worker,n.time,n.with_cost);self.postMessage(s,[s.buffer]);break}case"solve_week_part":{const _=j(n.state),s=t.solve_week_part(_,n.level,n.ban_list,n.time,n.with_cost,n.pattern,n.part_id);self.postMessage(s,[s.buffer]);break}case"solve_cache_clear":{t.solver_clear_cache(),self.postMessage({type:"solve_cache_clear"});break}case"simulate_multi":{const _=j(n.state),s=t.simulate(_,n.seq,n.demands);self.postMessage(s,[s.buffer]);break}case"simulate":return self.reportError("simulate is deprecated. use solve_multi_day instead");case"solve_day":return self.reportError("solve_day is deprecated. use solve_multi_day instead");default:console.log("unexpected type",n.type),self.reportError("unexpected type "+n.type);break}}}ee()})();
