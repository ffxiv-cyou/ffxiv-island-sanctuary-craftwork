(function(){"use strict";let r;const g=new Array(128).fill(void 0);g.push(void 0,null,!0,!1);function L(e){return g[e]}let M=g.length;function q(e){e<132||(g[e]=M,M=e)}function C(e){const t=L(e);return q(e),t}const R=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&R.decode();let A=null;function k(){return(A===null||A.byteLength===0)&&(A=new Uint8Array(r.memory.buffer)),A}function S(e,t){return e=e>>>0,R.decode(k().subarray(e,e+t))}let x=null;function F(){return(x===null||x.byteLength===0)&&(x=new Uint16Array(r.memory.buffer)),x}let c=0;function U(e,t){const n=t(e.length*2,2)>>>0;return F().set(e,n/2),c=e.length,n}function w(e,t){const n=t(e.length*1,1)>>>0;return k().set(e,n/1),c=e.length,n}function B(e,t,n){const _=U(e,r.__wbindgen_malloc),s=c,a=w(t,r.__wbindgen_malloc),i=c,o=r.init_repo(_,s,a,i,n);return y.__wrap(o)}function b(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`);return e.ptr}function z(e,t){b(e,y),r.set_pattern(e.__wbg_ptr,t)}let W=null;function l(){return(W===null||W.byteLength===0)&&(W=new Int32Array(r.memory.buffer)),W}function v(e,t){return e=e>>>0,F().subarray(e/2,e/2+t)}function H(e,t,n,_){try{const o=r.__wbindgen_add_to_stack_pointer(-16);b(e,y),b(t,p);const f=w(n,r.__wbindgen_malloc),u=c,d=w(_,r.__wbindgen_malloc),m=c;r.simulate(o,e.__wbg_ptr,t.__wbg_ptr,f,u,d,m);var s=l()[o/4+0],a=l()[o/4+1],i=v(s,a).slice();return r.__wbindgen_free(s,a*2),i}finally{r.__wbindgen_add_to_stack_pointer(16)}}function N(e,t,n,_,s,a,i){try{const d=r.__wbindgen_add_to_stack_pointer(-16);b(e,y),b(t,p);const m=U(_,r.__wbindgen_malloc),h=c,j=w(s,r.__wbindgen_malloc),I=c;r.solve_singleday(d,e.__wbg_ptr,t.__wbg_ptr,n,m,h,j,I,a,i);var o=l()[d/4+0],f=l()[d/4+1],u=v(o,f).slice();return r.__wbindgen_free(o,f*2),u}finally{r.__wbindgen_add_to_stack_pointer(16)}}function V(e,t){return e=e>>>0,k().subarray(e/1,e/1+t)}function $(e,t){try{const a=r.__wbindgen_add_to_stack_pointer(-16),i=w(e,r.__wbindgen_malloc),o=c;r.pattern_predict(a,i,o,t);var n=l()[a/4+0],_=l()[a/4+1],s=V(n,_).slice();return r.__wbindgen_free(n,_*1),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}function G(e,t){try{const a=r.__wbindgen_add_to_stack_pointer(-16),i=w(e,r.__wbindgen_malloc),o=c;r.pattern_predict_adv(a,i,o,t);var n=l()[a/4+0],_=l()[a/4+1],s=v(n,_).slice();return r.__wbindgen_free(n,_*2),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}let E=null;function J(){return(E===null||E.byteLength===0)&&(E=new Int8Array(r.memory.buffer)),E}function K(e,t){return e=e>>>0,J().subarray(e/1,e/1+t)}function P(e,t){try{const a=r.__wbindgen_add_to_stack_pointer(-16),i=w(e,r.__wbindgen_malloc),o=c;r.pattern_demand(a,i,o,t);var n=l()[a/4+0],_=l()[a/4+1],s=K(n,_).slice();return r.__wbindgen_free(n,_*1),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}function Q(e,t,n,_,s,a,i){try{const d=r.__wbindgen_add_to_stack_pointer(-16);b(e,y),b(t,p);const m=U(_,r.__wbindgen_malloc),h=c,j=w(i,r.__wbindgen_malloc),I=c;r.solve_week(d,e.__wbg_ptr,t.__wbg_ptr,n,m,h,s,a,j,I);var o=l()[d/4+0],f=l()[d/4+1],u=v(o,f).slice();return r.__wbindgen_free(o,f*2),u}finally{r.__wbindgen_add_to_stack_pointer(16)}}function X(e,t,n,_){try{const o=r.__wbindgen_add_to_stack_pointer(-16);b(e,y),b(t,p);const f=w(n,r.__wbindgen_malloc),u=c,d=w(_,r.__wbindgen_malloc),m=c;r.simulate_multi(o,e.__wbg_ptr,t.__wbg_ptr,f,u,d,m);var s=l()[o/4+0],a=l()[o/4+1],i=v(s,a).slice();return r.__wbindgen_free(s,a*2),i}finally{r.__wbindgen_add_to_stack_pointer(16)}}function Y(e,t,n,_,s,a,i,o,f){try{const h=r.__wbindgen_add_to_stack_pointer(-16);b(e,y),b(t,p);const j=U(_,r.__wbindgen_malloc),I=c,oe=w(s,r.__wbindgen_malloc),ae=c,ie=w(a,r.__wbindgen_malloc),ce=c;r.solve_multi_day(h,e.__wbg_ptr,t.__wbg_ptr,n,j,I,oe,ae,ie,ce,i,o,f);var u=l()[h/4+0],d=l()[h/4+1],m=v(u,d).slice();return r.__wbindgen_free(u,d*2),m}finally{r.__wbindgen_add_to_stack_pointer(16)}}function Z(e){M===g.length&&g.push(g.length+1);const t=M;return M=g[t],g[t]=e,t}const O=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ee=typeof O.encodeInto=="function"?function(e,t){return O.encodeInto(e,t)}:function(e,t){const n=O.encode(e);return t.set(n),{read:e.length,written:n.length}};function te(e,t,n){if(n===void 0){const o=O.encode(e),f=t(o.length,1)>>>0;return k().subarray(f,f+o.length).set(o),c=o.length,f}let _=e.length,s=t(_,1)>>>0;const a=k();let i=0;for(;i<_;i++){const o=e.charCodeAt(i);if(o>127)break;a[s+i]=o}if(i!==_){i!==0&&(e=e.slice(i)),s=n(s,_,_=i+e.length*3,1)>>>0;const o=k().subarray(s+i,s+_),f=ee(e,o);i+=f.written}return c=i,s}class p{static __wrap(t){t=t>>>0;const n=Object.create(p.prototype);return n.__wbg_ptr=t,n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_craftworkinfo_free(t)}get tension(){return r.__wbg_get_craftworkinfo_tension(this.__wbg_ptr)}set tension(t){r.__wbg_set_craftworkinfo_tension(this.__wbg_ptr,t)}get max_tension(){return r.__wbg_get_craftworkinfo_max_tension(this.__wbg_ptr)}set max_tension(t){r.__wbg_set_craftworkinfo_max_tension(this.__wbg_ptr,t)}get level(){return r.__wbg_get_craftworkinfo_level(this.__wbg_ptr)}set level(t){r.__wbg_set_craftworkinfo_level(this.__wbg_ptr,t)}get workers(){return r.__wbg_get_craftworkinfo_workers(this.__wbg_ptr)}set workers(t){r.__wbg_set_craftworkinfo_workers(this.__wbg_ptr,t)}constructor(t,n,_,s){const a=r.craftworkinfo_new(t,n,_,s);return p.__wrap(a)}}class y{static __wrap(t){t=t>>>0;const n=Object.create(y.prototype);return n.__wbg_ptr=t,n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_gamedatarepo_free(t)}}async function ne(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(_){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",_);else throw _}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function re(){const e={};return e.wbg={},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return Z(t)},e.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const _=L(n).stack,s=te(_,r.__wbindgen_malloc,r.__wbindgen_realloc),a=c;l()[t/4+1]=a,l()[t/4+0]=s},e.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let _,s;try{_=t,s=n,console.error(S(t,n))}finally{r.__wbindgen_free(_,s,1)}},e.wbg.__wbindgen_object_drop_ref=function(t){C(t)},e.wbg.__wbindgen_throw=function(t,n){throw new Error(S(t,n))},e}function _e(e,t){return r=e.exports,D.__wbindgen_wasm_module=t,W=null,E=null,x=null,A=null,r}async function D(e){if(r!==void 0)return r;typeof e>"u"&&(e="/assets/mji_craftwork_bg.wasm");const t=re();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:_}=await ne(await e,t);return _e(n,_)}function T(e){return new p(e.tension,e.max_tension,e.level,e.workers)}async function se(){await D(),self.postMessage({type:"inited"});let e;self.onmessage=async t=>{const n=t.data;if(n.type!=="init_repo"&&!e)return self.reportError("repo is not inited. "+n.type);switch(n.type){case"init_repo":e=B(n.recipe,n.pops,n.pop_row),self.postMessage({type:"init_repo"});break;case"set_pattern":z(e,n.pattern),self.postMessage({type:"set_pattern"});break;case"solve_day":{const _=T(n.state),s=N(e,_,n.level,n.ban_list,n.demands,n.time,n.with_cost);self.postMessage(s,[s.buffer]);break}case"solve_week":{const _=T(n.state),s=Q(e,_,n.level,n.ban_list,n.time,n.with_cost,n.pattern);self.postMessage(s,[s.buffer]);break}case"solve_multi_day":{const _=T(n.state),s=Y(e,_,n.level,n.ban_list,n.set,n.demands,n.worker,n.time,n.with_cost);self.postMessage(s,[s.buffer]);break}case"simulate":{const _=T(n.state),s=H(e,_,n.seq,n.demands);self.postMessage(s,[s.buffer]);break}case"simulate_multi":{const _=T(n.state),s=X(e,_,n.seq,n.demands);self.postMessage(s,[s.buffer]);break}case"pattern_predict":{const _=$(n.array,n.demands);self.postMessage(_,[_.buffer]);break}case"pattern_predict_adv":{const _=G(n.array,n.demands);self.postMessage(_,[_.buffer]);break}case"pattern_demand":{const _=P(n.array,n.day);self.postMessage(_,[_.buffer]);break}default:console.log("unexpected type",n.type),self.reportError("unexpected type "+n.type);break}}}se()})();
