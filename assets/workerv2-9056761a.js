(function(){"use strict";let r;const D=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&D.decode();let E=null;function x(){return(E===null||E.byteLength===0)&&(E=new Uint8Array(r.memory.buffer)),E}function L(t,n){return t=t>>>0,D.decode(x().subarray(t,t+n))}const v=new Array(128).fill(void 0);v.push(void 0,null,!0,!1);let F=v.length;function P(t){F===v.length&&v.push(v.length+1);const n=F;return F=v[n],v[n]=t,n}function S(t){return v[t]}let c=0;const j=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},H=typeof j.encodeInto=="function"?function(t,n){return j.encodeInto(t,n)}:function(t,n){const e=j.encode(t);return n.set(e),{read:t.length,written:e.length}};function N(t,n,e){if(e===void 0){const i=j.encode(t),l=n(i.length,1)>>>0;return x().subarray(l,l+i.length).set(i),c=i.length,l}let _=t.length,s=n(_,1)>>>0;const o=x();let a=0;for(;a<_;a++){const i=t.charCodeAt(a);if(i>127)break;o[s+a]=i}if(a!==_){a!==0&&(t=t.slice(a)),s=e(s,_,_=a+t.length*3,1)>>>0;const i=x().subarray(s+a,s+_),l=H(t,i);a+=l.written,s=e(s,_,a,1)>>>0}return c=a,s}let I=null;function f(){return(I===null||I.buffer.detached===!0||I.buffer.detached===void 0&&I.buffer!==r.memory.buffer)&&(I=new DataView(r.memory.buffer)),I}function $(t){t<132||(v[t]=F,F=t)}function G(t){const n=S(t);return $(t),n}let R=null;function C(){return(R===null||R.byteLength===0)&&(R=new Uint16Array(r.memory.buffer)),R}function J(t,n){const e=n(t.length*2,2)>>>0;return C().set(t,e/2),c=t.length,e}function d(t,n){const e=n(t.length*1,1)>>>0;return x().set(t,e/1),c=t.length,e}function M(t,n){if(!(t instanceof n))throw new Error(`expected instance of ${n.name}`)}function h(t,n){return t=t>>>0,C().subarray(t/2,t/2+n)}function K(t,n){return t=t>>>0,x().subarray(t/1,t/1+n)}function Q(t,n){try{const o=r.__wbindgen_add_to_stack_pointer(-16),a=d(t,r.__wbindgen_malloc),i=c;r.pattern_predict(o,a,i,n);var e=f().getInt32(o+4*0,!0),_=f().getInt32(o+4*1,!0),s=K(e,_).slice();return r.__wbindgen_free(e,_*1,1),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}function X(t,n){try{const o=r.__wbindgen_add_to_stack_pointer(-16),a=d(t,r.__wbindgen_malloc),i=c;r.pattern_predict_adv(o,a,i,n);var e=f().getInt32(o+4*0,!0),_=f().getInt32(o+4*1,!0),s=h(e,_).slice();return r.__wbindgen_free(e,_*2,2),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}let W=null;function Y(){return(W===null||W.byteLength===0)&&(W=new Int8Array(r.memory.buffer)),W}function Z(t,n){return t=t>>>0,Y().subarray(t/1,t/1+n)}function ee(t,n){try{const o=r.__wbindgen_add_to_stack_pointer(-16),a=d(t,r.__wbindgen_malloc),i=c;r.pattern_demand(o,a,i,n);var e=f().getInt32(o+4*0,!0),_=f().getInt32(o+4*1,!0),s=Z(e,_).slice();return r.__wbindgen_free(e,_*1,1),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}function te(t,n,e){const _=J(t,r.__wbindgen_malloc),s=c,o=d(n,r.__wbindgen_malloc),a=c,i=r.init_api_v2(_,s,o,a,e);return O.__wrap(i)}const V=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>r.__wbg_apiv2_free(t>>>0,1));class O{static __wrap(n){n=n>>>0;const e=Object.create(O.prototype);return e.__wbg_ptr=n,V.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const n=this.__wbg_ptr;return this.__wbg_ptr=0,V.unregister(this),n}free(){const n=this.__destroy_into_raw();r.__wbg_apiv2_free(n,0)}set_pattern(n){r.apiv2_set_pattern(this.__wbg_ptr,n)}simulate(n,e,_){try{const i=r.__wbindgen_add_to_stack_pointer(-16);M(n,k);const l=d(e,r.__wbindgen_malloc),g=c,u=d(_,r.__wbindgen_malloc),w=c;r.apiv2_simulate(i,this.__wbg_ptr,n.__wbg_ptr,l,g,u,w);var s=f().getInt32(i+4*0,!0),o=f().getInt32(i+4*1,!0),a=h(s,o).slice();return r.__wbindgen_free(s,o*2,2),a}finally{r.__wbindgen_add_to_stack_pointer(16)}}solve_day_with_batch(n,e,_,s,o,a,i,l){try{const b=r.__wbindgen_add_to_stack_pointer(-16);M(n,k);const p=d(_,r.__wbindgen_malloc),y=c,m=d(s,r.__wbindgen_malloc),T=c,z=d(o,r.__wbindgen_malloc),U=c;r.apiv2_solve_day_with_batch(b,this.__wbg_ptr,n.__wbg_ptr,e,p,y,m,T,z,U,a,i,l);var g=f().getInt32(b+4*0,!0),u=f().getInt32(b+4*1,!0),w=h(g,u).slice();return r.__wbindgen_free(g,u*2,2),w}finally{r.__wbindgen_add_to_stack_pointer(16)}}solve_day_dual(n,e,_,s,o,a,i){try{const w=r.__wbindgen_add_to_stack_pointer(-16);M(n,k);const b=d(_,r.__wbindgen_malloc),p=c,y=d(s,r.__wbindgen_malloc),m=c;r.apiv2_solve_day_dual(w,this.__wbg_ptr,n.__wbg_ptr,e,b,p,y,m,o,a,i);var l=f().getInt32(w+4*0,!0),g=f().getInt32(w+4*1,!0),u=h(l,g).slice();return r.__wbindgen_free(l,g*2,2),u}finally{r.__wbindgen_add_to_stack_pointer(16)}}solve_day_with_favor(n,e,_,s,o,a,i,l,g){try{const p=r.__wbindgen_add_to_stack_pointer(-16);M(n,k);const y=d(_,r.__wbindgen_malloc),m=c,T=d(s,r.__wbindgen_malloc),z=c,U=d(o,r.__wbindgen_malloc),oe=c,ae=d(a,r.__wbindgen_malloc),ie=c;r.apiv2_solve_day_with_favor(p,this.__wbg_ptr,n.__wbg_ptr,e,y,m,T,z,U,oe,ae,ie,i,l,g);var u=f().getInt32(p+4*0,!0),w=f().getInt32(p+4*1,!0),b=h(u,w).slice();return r.__wbindgen_free(u,w*2,2),b}finally{r.__wbindgen_add_to_stack_pointer(16)}}solve_week_single(n,e,_,s,o,a){try{const u=r.__wbindgen_add_to_stack_pointer(-16);M(n,k);const w=d(_,r.__wbindgen_malloc),b=c,p=d(a,r.__wbindgen_malloc),y=c;r.apiv2_solve_week_single(u,this.__wbg_ptr,n.__wbg_ptr,e,w,b,s,o,p,y);var i=f().getInt32(u+4*0,!0),l=f().getInt32(u+4*1,!0),g=h(i,l).slice();return r.__wbindgen_free(i,l*2,2),g}finally{r.__wbindgen_add_to_stack_pointer(16)}}solver_clear_cache(){r.apiv2_solver_clear_cache(this.__wbg_ptr)}solve_week_part(n,e,_,s,o,a,i){try{const w=r.__wbindgen_add_to_stack_pointer(-16);M(n,k);const b=d(_,r.__wbindgen_malloc),p=c,y=d(a,r.__wbindgen_malloc),m=c;r.apiv2_solve_week_part(w,this.__wbg_ptr,n.__wbg_ptr,e,b,p,s,o,y,m,i);var l=f().getInt32(w+4*0,!0),g=f().getInt32(w+4*1,!0),u=h(l,g).slice();return r.__wbindgen_free(l,g*2,2),u}finally{r.__wbindgen_add_to_stack_pointer(16)}}solve_week_favor(n,e,_,s,o,a,i){try{const w=r.__wbindgen_add_to_stack_pointer(-16);M(n,k);const b=d(_,r.__wbindgen_malloc),p=c,y=d(a,r.__wbindgen_malloc),m=c,T=d(i,r.__wbindgen_malloc),z=c;r.apiv2_solve_week_favor(w,this.__wbg_ptr,n.__wbg_ptr,e,b,p,s,o,y,m,T,z);var l=f().getInt32(w+4*0,!0),g=f().getInt32(w+4*1,!0),u=h(l,g).slice();return r.__wbindgen_free(l,g*2,2),u}finally{r.__wbindgen_add_to_stack_pointer(16)}}}const q=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>r.__wbg_craftworkinfo_free(t>>>0,1));class k{__destroy_into_raw(){const n=this.__wbg_ptr;return this.__wbg_ptr=0,q.unregister(this),n}free(){const n=this.__destroy_into_raw();r.__wbg_craftworkinfo_free(n,0)}get tension(){return r.__wbg_get_craftworkinfo_tension(this.__wbg_ptr)}set tension(n){r.__wbg_set_craftworkinfo_tension(this.__wbg_ptr,n)}get max_tension(){return r.__wbg_get_craftworkinfo_max_tension(this.__wbg_ptr)}set max_tension(n){r.__wbg_set_craftworkinfo_max_tension(this.__wbg_ptr,n)}get level(){return r.__wbg_get_craftworkinfo_level(this.__wbg_ptr)}set level(n){r.__wbg_set_craftworkinfo_level(this.__wbg_ptr,n)}get workers(){return r.__wbg_get_craftworkinfo_workers(this.__wbg_ptr)}set workers(n){r.__wbg_set_craftworkinfo_workers(this.__wbg_ptr,n)}constructor(n,e,_,s){const o=r.craftworkinfo_new(n,e,_,s);return this.__wbg_ptr=o>>>0,q.register(this,this.__wbg_ptr,this),this}}typeof FinalizationRegistry>"u"||new FinalizationRegistry(t=>r.__wbg_favor_free(t>>>0,1)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(t=>r.__wbg_gamedatarepo_free(t>>>0,1));async function ne(t,n){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,n)}catch(_){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",_);else throw _}const e=await t.arrayBuffer();return await WebAssembly.instantiate(e,n)}else{const e=await WebAssembly.instantiate(t,n);return e instanceof WebAssembly.Instance?{instance:e,module:t}:e}}function re(){const t={};return t.wbg={},t.wbg.__wbg_error_7534b8e9a36f1ab4=function(n,e){let _,s;try{_=n,s=e,console.error(L(n,e))}finally{r.__wbindgen_free(_,s,1)}},t.wbg.__wbg_new_8a6f238a6ece86ea=function(){const n=new Error;return P(n)},t.wbg.__wbg_stack_0ed75d68575b0f3c=function(n,e){const _=S(e).stack,s=N(_,r.__wbindgen_malloc,r.__wbindgen_realloc),o=c;f().setInt32(n+4*1,o,!0),f().setInt32(n+4*0,s,!0)},t.wbg.__wbindgen_object_drop_ref=function(n){G(n)},t.wbg.__wbindgen_throw=function(n,e){throw new Error(L(n,e))},t}function _e(t,n){return r=t.exports,B.__wbindgen_wasm_module=n,I=null,W=null,R=null,E=null,r}async function B(t){if(r!==void 0)return r;typeof t<"u"&&(Object.getPrototypeOf(t)===Object.prototype?{module_or_path:t}=t:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof t>"u"&&(t=new URL("/assets/mji_craftwork_bg-116d7e18.wasm",self.location));const n=re();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:e,module:_}=await ne(await t,n);return _e(e,_)}function A(t){return new k(t.tension,t.max_tension,t.level,t.workers)}async function se(){await B(),self.postMessage({type:"inited"});let t;self.onmessage=async n=>{const e=n.data;switch(e.type){case"init_repo":t=te(e.recipe,e.pops,e.pop_row),self.postMessage({type:"init_repo"});return;case"pattern_predict":{const _=Q(e.array,e.demands);self.postMessage(_,[_.buffer]);return}case"pattern_predict_adv":{const _=X(e.array,e.demands);self.postMessage(_,[_.buffer]);return}case"pattern_demand":{const _=ee(e.array,e.day);self.postMessage(_,[_.buffer]);return}default:if(!t)return self.reportError("repo is not inited. "+e.type);break}switch(e.type){case"set_pattern":t.set_pattern(e.pattern),self.postMessage({type:"set_pattern"});break;case"solve_week":{const _=A(e.state),s=t.solve_week_single(_,e.level,e.ban_list,e.time,e.with_cost,e.pattern);self.postMessage(s,[s.buffer]);break}case"solve_multi_day":{const _=A(e.state),s=t.solve_day_with_batch(_,e.level,e.ban_list,e.set,e.demands,e.worker,e.time,e.with_cost);self.postMessage(s,[s.buffer]);break}case"solve_day_dual":{const _=A(e.state),s=t.solve_day_dual(_,e.level,e.ban_list,e.demands,e.worker,e.time,e.with_cost);self.postMessage(s,[s.buffer]);break}case"solve_day_favor":{const _=A(e.state),s=t.solve_day_with_favor(_,e.level,e.ban_list,e.set,e.demands,e.favors,e.worker,e.time,e.with_cost);self.postMessage(s,[s.buffer]);break}case"solve_week_part":{const _=A(e.state),s=t.solve_week_part(_,e.level,e.ban_list,e.time,e.with_cost,e.pattern,e.part_id);self.postMessage(s,[s.buffer]);break}case"solve_week_favor":{const _=A(e.state),s=t.solve_week_favor(_,e.level,e.ban_list,e.time,e.with_cost,e.pattern,e.favors);self.postMessage(s,[s.buffer]);break}case"solve_cache_clear":{t.solver_clear_cache(),self.postMessage({type:"solve_cache_clear"});break}case"simulate_multi":{const _=A(e.state),s=t.simulate(_,e.seq,e.demands);self.postMessage(s,[s.buffer]);break}case"simulate":return self.reportError("simulate is deprecated. use simulate_multi instead");case"solve_day":return self.reportError("solve_day is deprecated. use solve_multi_day instead");default:console.log("unexpected type",e.type),self.reportError("unexpected type "+e.type);break}}}se()})();
